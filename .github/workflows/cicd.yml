name: CI/CD Pipeline

on:
push:
branches:
- main

jobs:
build-and-deploy:
runs-on: ubuntu-latest

```
steps:
  - name: Checkout repository
    uses: actions/checkout@v3

  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: 3.12

  - name: Install dependencies
    run: |
      python -m pip install --upgrade pip
      pip install -r requirements.txt

  - name: Run tests
    run: pytest

  - name: Login to Docker Hub
    uses: docker/login-action@v2
    with:
      username: ${{ secrets.DOCKERHUB_USER }}
      password: ${{ secrets.DOCKERHUB_TOKEN }}

  - name: Build Docker image
    run: docker build -t ${{ secrets.DOCKERHUB_USER }}/tasks-api:${GITHUB_SHA} .

  - name: Push Docker image
    run: docker push ${{ secrets.DOCKERHUB_USER }}/tasks-api:${GITHUB_SHA}

  - name: Deploy to server
    uses: appleboy/ssh-action@v0.1.7
    with:
      host: ${{ secrets.SSH_HOST }}
      username: ${{ secrets.SSH_USER }}
      key: ${{ secrets.SSH_KEY }}
      port: 22
      script: |
        cd ~/meu_gerenciador_de_tarefas
        docker-compose -f docker-compose.prod.yml pull
        docker-compose -f docker-compose.prod.yml up -d --remove-orphans
```
